// api/generate-document.js
const { PDFDocument, rgb } = require('pdf-lib'); // Recomendo usar pdf-lib ou pdfkit

exports.handler = async (event) => {
    try {
        const data = JSON.parse(event.body);
        
        // Dados profissionais fixos
        const profissional = {
            nome: "Agnes Benites",
            oab: "541659/SP",
            email: "agnesbenites@gmail.com"
        };

        // Simulação de geração - Aqui você deve chamar suas funções de template (contrato-moderno, etc)
        // O código abaixo prepara o buffer para retorno
        
        // Mock de geração de buffer (substitua pela lógica do pdfkit se preferir)
        const pdfBuffer = Buffer.from("PDF GENERATED BY AGNES BENITES OAB 541659");

        return {
            statusCode: 200,
            headers: {
                'Content-Type': 'application/pdf',
                'Content-Disposition': `attachment; filename="documento_${Date.now()}.pdf"`,
                'Access-Control-Allow-Origin': '*' // Importante para o Cloudflare
            },
            body: pdfBuffer.toString('base64'),
            isBase64Encoded: true,
        };
    } catch (error) {
        console.error("Erro na geração:", error);
        return {
            statusCode: 500,
            body: JSON.stringify({ error: "Erro interno ao gerar documento." })
        };
    }
};